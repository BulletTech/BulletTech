---
template: overrides/blogs.html
---

# KDD Cup2021时间序列异常检测竞赛总结

!!! info 
    作者：Void，发布于2021-10-30，阅读时间：约10分钟，微信公众号文章链接：[:fontawesome-solid-link:](https://mp.weixin.qq.com/s/XwtXpa1hOKrN6fIC-zpyKw)

## 1 引言

我们在[今天你异常了吗]()这篇文章中曾介绍过KDD Cup2021的时间序列异常检测竞赛。竞赛要求我们在250个时间序列中找出每个序列中的唯一异常点所在区间。  
最近，我们偶然发现了赛事公布了最终高分团队的解决方案。扶我起来我还能学，今天让我们一起来看一下这些高分方案吧。

## 2 第一名：DBAI

第一名是来自深兰科技(DeepBlue Technology)的团队。这家公司有一些AI机器人的产品，也很热衷于参加各类竞赛。它们的解决方案是：TsaDetect: An efficient and flexible time series anomaly detection framework。  
总的来说，他们集成了几种时间序列异常检测的算法，得到了不错的效果。  

由于本次竞赛提供的时间序列都是很规律、周期很明显的序列，其中的异常点，其实更可以被称为异常周期。如何找到时间序列的周期成为了我们需要解决的第一个问题。  
我们自己在竞赛中，采用了傅里叶变换的方式寻找周期。那么什么是傅里叶变换呢？  

首先，傅里叶级数的概念是说任何周期函数都可以分解成不同周期(或者说不同频率，频率等于周期的倒数)的正弦函数相加。那么这些不同的频率就构成了这个序列的频谱。横轴为频率，纵轴为振幅。  

<figure>
  <img src="https://cdn.jsdelivr.net/gh/BulletTech2021/Pics/2021-6-14/1623639526512-1080P%20(Full%20HD)%20-%20Tail%20Pic.png" width="500" />
</figure>

一般来说，在频谱中，振幅最大的点的频率是原始序列的频率，因为此时这个频率以及振幅的正弦函数包括了原始序列的峰谷值。我们可以通过这种方式确定原始序列的周期。  

我们可以通过以下代码，在Python中绘制序列的频谱图。

```python
import scipy
import matplotlib.pyplot as plt

X = scipy.fft.fft(this.values.reshape((-1,))) #傅里叶变换后的值
freqs = scipy.fft.fftfreq(len(this.values),1)
fig=plt.figure(figsize=(20,12))
plt.plot(freqs,np.abs(X))#np.abs是模
```

我们使用竞赛提供的序列试一试，

<figure>
  <img src="https://cdn.jsdelivr.net/gh/BulletTech2021/Pics/2021-6-14/1623639526512-1080P%20(Full%20HD)%20-%20Tail%20Pic.png" width="500" />
</figure>

现实很骨感，通过这种方式并不能很好的找到原始序列的周期。可以说傅里叶变换寻找周期是一种传统的寻找周期的方式，但在某些序列中并不适合。  
下面，我们来看看高分方案是怎么做的

## 7 小结

对于这类周期性较强的时间序列，异常检测的目标是找出差异较大的子序列。可以看到，matrixprofile已经能够达到不错的效果。当然，还有更多复杂、fancy的算法，如频谱相关的算法等，有待进一步发掘。

<figure>
  <img src="https://cdn.jsdelivr.net/gh/BulletTech2021/Pics/2021-6-14/1623639526512-1080P%20(Full%20HD)%20-%20Tail%20Pic.png" width="500" />
</figure>
