---
template: overrides/blogs.html
tags:
  -Knowledge Graph
---

# Neo4j diagram database anti -fraud analysis actual combat (4) -risk score

!!! Info
    Author: [vincent] (https://github.com/realvincentyuan), published in 2021-06-06, reading time: about 6 minutes, WeChat public account article link: [: fontaWesome-solid-Link:] (https://mp.weixin.qqqpom/s ?__biz=mzi4mjk3nzgxoq==&mid=2247485268&IDX=1&Sn=2F32B4911dd6496f2ef287420dce77D36488 9CD350674AF9C4523C05D884AFAE5A158C619FAABFCA5E1616443131 & Token = 200682583 & Lang = zh_cn#RD)

## 1 Introduction

The NEO4J diagram database anti -fraud series articles will recognize dangerous users here. The content of this issue will explain the risk score of each customer.If you need to review the previous article, you can directly jump the link:

- [Database of the first recognition] (https://mp.weixin.qq.com/s ?__biz=mzi4mjk3ngxoq=&mid=2247485112&IDX=1&SN4FD472A3D58378A2F&CHKKSM=EB9 0F5CCDCDCDA0285D53331834A787364D4458A3588173c9ef6953499362BD64F7C918 & Token = 1650861834 & LANG = zh_cn#RD)
- [NEO4J diagram database anti -fraud analysis actual combat (1) -Coly build an analytical environment] (https://mp.weixin.qq.com/s ?__biz=mzi4mjk3nzgxoq==2247485213&idx=1c888847bcf35ef6e 21AF6005F4 & CHKSM = EB90F469DCE77D7FA1325810D537E183C65EF7067F20219EEE02D6F3667D14554832103986d & Token = 771475859 & LANG = zh_cn#rd)
- [NEO4J diagram database anti -fraud analysis actual combat (2) -Fore preparation data] (https://mp.weixin.qq.com/s ?__biz=mzi4mjk3ngxoq===2247485256&IDX=1&A1D09098282F85F3D2399 5372C8ED & CHKSM = EB90F43CDCE77D2AF75E6313E945A83F230974E7E7E7E7E0855C99D9ECECE6F3D24F3AD06AE80A4 & Token = 771475859 & LANG = zh_cn#RD)
- [NEO4J diagram database anti -fraud analysis actual combat (3) -Adfill criminal gang] (ttps://mp.weixin.qq.com/s? __Biz = mzi4mjk3nzgxoq == & mid = 2247485261 & IDX = 1 & Sn = 9bbe4e099d7e 199d749540797e82e443 & chksm = EB90F439DCE77D2FB5A8F06707844F0EEF22667821F97D9E5095636cebb2ed1903994056dd & Tokeen = 148153822525 & lang = zh_cn#rd)

## 2 Find similar nodes

Next, you can find customers similar to each other in each cluster.

<figure>
  <img src = "https://cdn.jsdelivr.net/gh/bullettech2021/pics/img/1_v/cluster_1.png"/>/>
  <figcaption> WCC cluster results </figcaption>
</Figure>

This step uses node similarity ([jaccard value] (https://neo4j.com/docs/graph-data-science/current/algorithms/node-similagorithms-similalicy 'nodes are similar to similar Degree)Judging that the node similarity algorithm requires two nodes in the graph structure, so the `Similalicy` chart is created, which contains two nodes: customer and physical information, and the corresponding relationship.

`` `SQL
Call gds.graph.project.cypher ('SimiLARITY',
'MATCH (C: Client)
    Where Exist
    Return ID (C) as id, labels (c) as labels
Union
Match (n)
    Where n: email or n: phone or n: ssn
    Return ID (n) as id, labels (n) as labels',
'MATCH (C: Client)
-[: has_email |: has_phone |: has_ssn]-> (IDS)
Where Exist
Return ID (C) as source, ID (IDS) as target ')
Yield graphname, nodcount, relatedshipCount;
`` `

After creating a diagram, you can run node similarity algorithms (note: this algorithm supports weighted, see the document for details):

`` `SQL
Call gds.NodeSimilalicy.stream ('SimiLARITY', {Topk: 15})
Yield node1, node2, similalicy
Return gds.util.asnode (node1) .id as Client1,
    gds.util.asnode (node2) .id as Client2, Similalicy
Order by Similalicy;
`` `

Use the `Mutate` mode to write the results in the figure in memory, and create a new relationship` similar_to`.At this point, similar nodes can be used to measure similarity with JaccardScore:

`` `SQL
Call gds.NodeSimiLority.mutate ('SimiLARITY', {Topk: 15,
  MutateProperty: 'JaccardScore', MutterrelationShipType: 'Similar_to'});

-Chimore the result from the diagram in the memory into the database
Call gds.graph.writeRelationship ('SimiLARITY', 'SimiLAR_TO', 'JaccardScore');
`` `

## 3 Create risk scores

Next, use the [node center algorithm] (https://neo4j.com/docs/graph-data-sCinence/current/algorithms/degree--'degree Centrality') to generate a `f` f IRSTPARTYFRAUDSCOR`,` Firstpartyfraudscore`, the higher the division, represents more similar physical information in a cluster with more customers, that is, the more dangerous.


`` `SQL
Call gds.degree.write ('SimiLARITY', {Nodelabels: ['Client'],
    RelationshipTypes: ['Similar_to'],
    RelationshipsHipweightProperty: 'JaccardScore',
    writeProperty: 'firstpartyfraudscore'});
`` `

<figure>
  <img src = "https://cdn.jsdelivr.net/gh/bullettech2021/pics/img/1_v/score.png"/>/>/>
  <figcaption> Risk Rating </figcaption>
</Figure>


Finally, customers with 80 points are the danger of threshold labeling. In practical applications, you can also directly use the `firstpartyfraudscore` as a separate features to integrate anti -fraud strategies or models.

`` `SQL
Match (c: client)
Where Exist
With PercentileCont (C.FirspartyfraudsCore, 0.8)
    As firstpartyfraudhreshold
Match (c: client)
Where
Set C: firstpartyfraudster;
`` `

## 4 Summary

At this point, the actual combat series of fraud criminals in the recognition relationship network came to an end. Through this series of articles, I recognized and consolidated the following knowledge points:

-The basic structure
-NEO4J diagram database query sentence Cypher commonly used commands
-Septer algorithm in anti -fraud applications

I hope that the sharing of this actual combat series will help you, please leave a message in the comment area!

<figure>
  <img src = "httts://cdn.jsdelivr.net/gh/bullettech2021/pics/2021-6-14/1623639526512-1080p%20hd)%20tail .png" widt "widt" widt "widt h = "500 " />
</Figure>