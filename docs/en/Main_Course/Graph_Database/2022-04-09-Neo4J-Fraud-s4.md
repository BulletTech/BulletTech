---
template: overrides/blogs.html
tags:
  - knowledge graph
---

# Neo4J图数据库反欺诈分析实战（四） - 风险评分

!!! info
    Author:：[Vincent](https://github.com/Realvincentyuan)，Posted on 2021-06-06，Reading time: 6 mins，WeChat Post Link:：[:fontawesome-solid-link:](https://mp.weixin.qq.com/s?__biz=MzI4Mjk3NzgxOQ==&mid=2247485268&idx=1&sn=2f32b4911dd64a5696f2ef287b9542a0&chksm=eb90f420dce77d36489cd350674af9c4523c05d884afae5a158c619faaabfca5e161b9443131&token=200682583&lang=zh_CN#rd)

## 1 Introduction


The NEO4J diagram database anti -fraud series articles will recognize dangerous users here. The content of this issue will explain the risk score of each customer.If you need to review the previous article, you can directly jump the link:


-
[First recognition database] (https://mp.weixin.qq.com/s ?__biz=mzi4mjk3nzgxoq=&mid=2247485112&IDX=1&SN4FD472A3D58378A2F&CHKKKKSM=EB90909090 F5CCDCE77CDA0285D53331834A787364D4458A3588173C9EF695349362BD64F7C918 & Token = 1650861834 & LANG = zh_cn#RD)
-
[NEO4J Database Database Anti -Fraud Analysis Real War (1) -Colate Analysis Environment] (https://mp.weixin.qq.com/s ?__biz=mzi4mjk3ngxoq===2247485213&IDX=ED9051C887847BCF35EF6E22 1AF6005F4 & CHKSM = EB90F469DCE77D7FA1325810D537E183C65EF7067F20219EEE02D6F3667D14554832103986d & Token = 771475859 & LANG = zh_cn#RD)
-
[NEO4J diagram database anti -fraud analysis actual combat (2) -Fore preparation data] (https://mp.weixin.qq.com/s ?__biz=mzi4mjk3ngxoq===2247485256&IDX=1&A1D090982F85F3D2395 372c8ed & chksm = EB90F43CDCE77D2AF75E6313E945A83F230974E7E7E7E7E0855C99D9ECECE6F3D24F3AD06AE80A4 & Token = 771475859 & LANG = zh_cn#RDCure
-
[NEO4J Figure Database Anti -Fraud Analysis Real War (3) -Adivation of Criminal Gang] (ttps://mp.weixin.qq.com/s? __Biz = mzi4mjk3nzgxoq == & mid = 2247485261 & IDX = 1 & Sn = 9bbe4e099d7e11111 99d749540797e82e443 & chksm = EB90F439DCE7777777777777777777777777777777777777777777777777777777777D2FB5A8F0670784F0EEF22667821F97D9E5095636cebb2ed1903994056dd & TOKen = 148153822525 & lang = zh_cn#RD)


## 2 Find similar nodes


Last time passed
[弱连接分量（Weakly Connected Components）](https://neo4j.com/docs/graph-data-science/current/algorithms/wcc/ 'Weakly Connected Components')
The algorithm has a cluster of data.Next, you can find customers similar to each other in each cluster.


<figure>
  <img src="https://cdn.jsdelivr.net/gh/BulletTech2021/Pics/img/1_V/cluster_1.png"  />

<figcaption> WCC cluster results </figcaption>
</figure>


This step uses node similarity (
[Jaccard value] (https://neo4j.com/docs/graph-data-science/current/algorithms/node-similarity/#algorithms-nimilarity ')
) To judge, the node similarity algorithm requires two nodes in the graph structure, so the `SimiLARARITY` chart contains two nodes: customer and physical information, and the corresponding relationship.


```sql
CALL gds.graph.project.cypher('Similarity',
'MATCH(c:Client)
WHERE exists(c.firstPartyFraudGroup)
RETURN id(c) AS id,labels(c) AS labels
UNION
MATCH(n)
WHERE an:Email OR and:Phone OR no:SSN
RETURN id(n) AS id,labels(n) AS labels',
'MATCH(c:Client)
-[:HAS_EMAIL|:HAS_PHONE|:HAS_SSN]->(ids)
WHERE exists(c.firstPartyFraudGroup)
RETURN id(c) AS source,id(ids) AS target')
YIELD graphName,nodeCount,relationshipCount;
```


After creating a diagram, you can run node similarity algorithms (note: this algorithm supports weighted, see the document for details):


```sql
CALL gds.nodeSimilarity.stream('Similarity',{topK:15})
YIELD node1,node2,similarity
RETURN gds.util.asNode(node1).id AS client1,
gds.util.asNode(node2).id AS client2,similarity
ORDER BY similarity;
```


Use the `Mutate` mode to write the results in the figure in memory, and create a new relationship` similar_to`.At this point, similar nodes can be used to measure similarity with JaccardScore:


```SQL
CALL gds.nodeSimilarity.mutate('Similarity',{topK:15,
mutateProperty:'jaccardScore', mutateRelationshipType:'SIMILAR_TO'});


-Chimore the result from the diagram in the memory into the database
CALL gds.graph.writeRelationship('Similarity','SIMILAR_TO','jaccardScore');
```


## 3 Create risk scores


Next
[Node Central Agential Algorithm] (https://neo4j.com/docs/graph-data-science/curgorithms/degree-) degree centeritity '))))))))
A combination of the above -mentioned similarity indicators generate a `firstpartyfraudsCore`. The higher the division of` firstpartyfraudscore`, which means that the more similar physical information is in a cluster, the more dangerous.




```SQL
CALL gds.degree.write('Similarity',{nodeLabels:['Client'],
relationshipTypes:['SIMILAR_TO'],
relationshipWeightProperty:'jaccardScore',
writeProperty:'firstPartyFraudScore'});
```


<figure>
  <img src="https://cdn.jsdelivr.net/gh/BulletTech2021/Pics/img/1_V/Score.png"  />

<figcaption> Risk Rating </figcaption>
</figure>




Finally, customers with 80 points are the danger of threshold labeling. In practical applications, you can also directly use the `firstpartyfraudscore` as a separate features to integrate anti -fraud strategies or models.


```sql
MATCH(c:Client)
WHERE exists(c.firstPartyFraudScore)
WITH percentileCont(c.firstPartyFraudScore, 0.8)
From firstpartyfraudthrereshold
MATCH(c:Client)
WHERE c.firstPartyFraudScore>firstPartyFraudThreshold
SET c:FirstPartyFraudster;
```


## 4 Summary


At this point, the actual combat series of fraud criminals in the recognition relationship network came to an end. Through this series of articles, I recognized and consolidated the following knowledge points:


-The basic structure
-NEO4J diagram database query sentence Cypher commonly used commands
-Septer algorithm in anti -fraud applications


I hope that the sharing of this actual combat series will help you, please leave a message in the comment area!


<figure>
  <img src="https://cdn.jsdelivr.net/gh/BulletTech2021/Pics/2021-6-14/1623639526512-1080P%20(Full%20HD)%20-%20Tail%20Pic.png" width="500" />

</figure>