---
template: overrides/blogs.html
tags:
  -Knowledge Graph
---

# NEO4J diagram database anti -fraud analysis actual combat (3) -Infirmation of criminal gangs

!!! Info
    Author: [vincent] (https://github.com/realvincentyuan), published in 2021-06-06, reading time: about 6 minutes, WeChat public account article link: [: fontaWesome-solid-Link:] (https://mp.weixin.qqqpom/s ?__biz=mzi4mjk3nzgxoq==&mid=2247485261&IDX=1&Sn=9bbe4e099d74954079739DCE7777D2FB55 A8F06707844F0EEF22667821F97D9E509563A36ceb2ed1903994056dd & Token = 1481538225 & Lang = zh_cn#RD)

## 1 Introduction

Last time in the [NEO4J diagram database anti -fraud analysis actual combat (2) -Fit data] (https://mp.weixin.qq.com/s ?__biz=mzi4mjk3nzgxoq==2247485256&IDX=1&A1D09090982F85F3D22 395372c8ed & chksm = EB90F43CDCDCE7777775E6313E945A83F230974E7E7E7E0855C99D9ECECE6F3D24F3AE80A4 & Token = 771475859 & LANG =In zh_cn#rd), the author introduced how to import the data into the NEO4J analysis platform and did some simple descriptive analysis on customers and transaction information. NextTelephone, ID number, etc.) are intertwined with many other account numbers, so you can find clues through these shared information.

## 2 Share identity information

In the previous section, the relationship between the customer and the entity has been defined, such as the customer has emails, telephones, SSN, etc. If multiple customers use the same information, these contacts can ensure that they are connected.Greatly helped us deconstruct complex relationships.However, if you want to run a specific diagram algorithm, you need to deal with these relationships, because the diagram structures applied to the diagram algorithm are different. Some algorithms are suitable for the diagram of the `` `` all in the graph.There is only the same relationship.Some algorithms are suitable for the diagram of the heterogeneity, which contains multiple types of nodes and relationships.

The example provided by NEO4J uses [Weakly Connected Components] (https://neo4j.com/docs/graph-data-current/wcc/ 'Weakly Connect COMP OneNTS ') algorithm looking for universeThe node connected in the medium is suitable for the same composition, so a new relationship needs to be created-`Shared_identifiers` to calculate the number of physical information shared between each customer, such as the email, telephone and SSN of customers A and B.Then the attributes of shared_identifiers are 3.

`` `SQL
// Create Shared_identifiers Relations
Match (C1: Client)-[: Has_email |: HAS_PHONE |: HAS_SSN]-> (Info)
<-[: has_email |: has_phone |: has_ssn]-(C2: client)
Where c1.id <> c2.id
With C1, C2, Count (*) as CNT
Merge (C1) - [: Shared_identifiers {Count: CNT}] - (C2);
`` `

In the command, the keywords of the `with` can connect the query statement together, so that the last step variables are continued to be used in the next step.The use of the keywords of `Merge` is very wide. In general, it can make a model exist in the figure. If the mode does not exist, that is, the new model is created, which is used here to create a relationship.Please note that the amount of data in the example is small, only 300,000 nodes. If the number of nodes is huge, it is recommended to use [APOC] (https://neo4j.com/labs/apoc/4.2/overView/apoc.Periodic provided by NEO4J/APOC.Periodic.iterate/ 'Apoc.Periodic.iterate') method is calculated in batches.

## 3 Create a picture

Before running any algorithm, you must first create a picture. You can use the `Shared_IDENTIFIERS` Relationship to build the previously created and map it to the memory. ThereforeThe

`` `SQL
Call gds.graph.create.cypher.ESTIMATE (
'MATCH (C: CLIENT) Return ID (C) as id',
'MATCH (C1: Client)-[R: Shared_identifiers]-(C2: Client)
Where c1.id <> c2.id
Return ID (C1) As Source, ID (C2) as target, R.Count as weight ')
Yield requiredMemory, nodecount, RelationshipshipCount;
`` `

The output is:

| RequiredMemory | NodeCount | RelationshipshipCount |
| --- | --- | --- | |
| "8804 kib" | 2433 | 1517 |

Make sure that the memory is sufficient to formally create a picture:

`` `SQL
Call gds.graph.create ('WCC', 'Client',
{{
    Shared_identifiers: {
        Type: 'Shared_IDENTIFIERS',
        Properties: {
            count: {{
                Property: 'Count'
                }
            }
        }
}
) Yield graphname, nodecount, relatedshipCount, createmillis;
`` `

If it runs normally, you can use the `call gds.graph.list ();` command to view the created diagram.

## 4 execute WCC algorithm clustering class

Similarly, it is recommended to estimate the memory resources before performing the algorithm, but it will not be repeated here. Run the WCC to use the following commands.`Set` instructions can give the value to a new attribute. Here is a label for the cluster where the customer is located. It can be seen that the code has excluded the situation where there is only one customer in the cluster, because those people and others have no other people that no other people have no other people.Related.

`` `SQL
Call GDS.WCC.Stream ('WCC')
Yield componentid, nodeid
With componentid as cluster, gds.util.asnode (nodeid) as client
With cluster, colorct (client.id) as Clients -Collect combined a sequence
With *, size (clients) as clustersize
Where clustersize> 1
Unwind clients as client -unwind to expand a sequence
Match (c: client)
Where c.id = client
Set C.FirtPartyfraudgroup = Cluster;
`` `

The WCC algorithm helps identify people who need attention, and the next algorithm can continue to be calculated based on the cluster results.

## 5 Summary

This part has completed the reorganization of crowd relations and identified groups with similar characteristics, which is convenient for subsequent analysis.At the same time, commonly used technical points, such as with, Merge, SET, APOC, memory estimation, creating diagrams and running graph algorithms, the next time is explained as a dangerous population for scores to effectively identify fraud criminals.

<figure>
  <img src = "httts://cdn.jsdelivr.net/gh/bullettech2021/pics/2021-6-14/1623639526512-1080p%20hd)%20tail .png" widt "widt" widt "widt h = "500 " />
</Figure>