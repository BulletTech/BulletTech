---
template: overrides/blogs.html
tags:
  - knowledge graph
---

# Neo4J图数据库反欺诈分析实战（二） - 准备数据

!!! info
    Author:：[Vincent](https://github.com/Realvincentyuan)，Posted on 2021-06-06，Reading time: 6 mins，WeChat Post Link:：[:fontawesome-solid-link:](https://mp.weixin.qq.com/s?__biz=MzI4Mjk3NzgxOQ==&mid=2247485256&idx=1&sn=0d87a1d090f7282f85f3d2395372c8ed&chksm=eb90f43cdce77d2af75e6313e945a83f2309743e7e7e0855c99d9ecece6f3d24f3ad06ae80a4&token=771475859&lang=zh_CN#rd)

## 1 Introduction


exist
[NEO4J Database Database Anti -Fraud Analysis Real War (1) -Colate Analysis Environment] (https://mp.weixin.qq.com/s ?__biz=mzi4mjk3ngxoq===2247485213&IDX=ED9051C887847BCF35EF6E22 1AF6005F4 & CHKSM = EB90F469DCE77D7FA1325810D537E183C65EF7067F20219EEE02D6F3667D14554832103986d & Token = 771475859 & LANG = zh_cn#RD)
In this article, the operation of the NEO4J analysis platform and some basic map databases. This article officially began to explore the theme of anti -fraud.The primary task is to clarify the goals, obtain data and sort out data.The example provided by NEO4J is concerned about fraudulent criminals to control a large number of accounts for fraud transactions using the same physical information, so the goal is to find out the connection between these accounts and the criminal gangs.However, this example does not introduce the source of the data and the arrangement of data, and this part is actually very critical in the real work, so this article will focus on explaining the part of the data preparation.


## 2 Get data


Neo4j provides
[Various ways] (https://neo4j.com/developer/data-import/ 'Import data to NEO4J')
Connect the data warehouse:


-The manual data
-Worne the CSV file
-Prod with API to import data
-In import data from the relational database
-In use of application -driven connection to import data (supporting multiple programming languages such as .NET, Java, JavaScript, GO, Python, etc.))


Among them, I want to use the Python driver to import data, because usually, you can first use the Python to obtain the original data in the relationship database, and use the NEO4J interface to connect multiple platforms to complete the data transmission work.Facing the ultra -large data set, using pyspark can also further improve the computing performance, NEO4J also provides provided
[Pyspark's interface] (https://neo4j.com/docs/spark/current/python/ 'neo4j pyspark interface'), read and write speed very fast. The following is the pyspark example code. Please note that you need to download the corresponding [the corresponding before use.Pyspark version of the NEO4J connector jar file]
。


<figure>
  <img src="https://cdn.jsdelivr.net/gh/BulletTech2021/Pics/img/1_V/Neo4J连接信息.png"  />

<figcaption> neo4j connection information </figcaption>
</figure>




```Python
# Read the data of NEO4J
#Chn the account password with the own settings
df = spark.read.format("org.neo4j.spark.DataSource")\
.option("url", "bolt+s://63d2d43273493b399454b26961152ed9.neo4jsandbox.com:7687")\
.option("authentication.type", "basic")\
.option("authentication.basic.username", "neo4j")\
.option("authentication.basic.password", "password")\
.option("labels", "Person")\
.load()


display(df)


# O to NEO4J
df2 = spark.createDataFrame( [(1, "John"),(2, "Thomas")],
["id", "name"]
)


df2.write.format("org.neo4j.spark.DataSource")\
.option("url", "bolt+s://63d2d43273493b399454b26961152ed9.neo4jsandbox.com:7687")\
.option("authentication.type", "basic")\
.option("authentication.basic.username", "neo4j")\
.option("authentication.basic.password", "password")\
.option("labels", ":Person")\
.option("node.keys", "id")\
.mode("Overwrite")\
.save()
```


Remember, before loading the data
[定义Index](https://neo4j.com/docs/cypher-manual/current/indexes-for-search-performance/ 'Indexes for search performance')
This operation will significantly increase the speed of the program.


## 3 Define nodes and relationships


<figure>
  <img src="https://cdn.jsdelivr.net/gh/BulletTech2021/Pics/img/1_V/节点和关系.png"  />

<figcaption> nodes and relationships </figcaption>
</figure>


As shown in the figure, the colorful circle represents the node, and the connection between nodes is the relationship.In intuitive, the original data is a table, which contains some fields related to the target, and each field corresponds to this entity (node).


| Mule | Phone     | Email           |
|------|-----------|-----------------|
| John | 888888888 | demo@gmail.com  |
| Tim  | 777777777 | demo2@gmail.com |


The node can be written with the above code to NEO4J, the relationship between the entity and the entity
[You can be defined by cypher] (https://neo4j.com/docs/cypher-manual/current/clauses/create/#create-relationships' Create Relationships in NEO4J)
For example, John has its own mailbox to define the following ways:


```sql
MATCH
(a:Mule),
(b:Email)
WHERE a.Email = b.Email
CREATE (a)-[r:HAS_EMAIL]->(b)
RETURN type(r)
```


In this kind of push, the useful relationship of targets can be defined in this way.


## 4 Data Overview


The first part of the anti -fraud example described the data to analyze the data, such as the number of nodes, the number of relationships, and other information, which helps help understand the data and check the integrity of the data. Make sure that the data you need is stored in accordance with the set goals.NEO4J, the module is relatively intuitive, not to repeat it too much.


<figure>
  <img src="https://cdn.jsdelivr.net/gh/BulletTech2021/Pics/img/1_V/描述性统计.png"  />

<figcaption> descriptive analysis </figcaption>
</figure>


## 5 Summary


This article solves the initial doubts of many beginners of the map database. How to import data (usually tables) into NEO4J, and define nodes and relationships that serve the target.There is no doubt that this is the basis of the follow -up analysis work, and then you can formally analyze these data against fraud.I hope this sharing will help you, please leave a message in the comment area!


<figure>
  <img src="https://cdn.jsdelivr.net/gh/BulletTech2021/Pics/2021-6-14/1623639526512-1080P%20(Full%20HD)%20-%20Tail%20Pic.png" width="500" />

</figure>